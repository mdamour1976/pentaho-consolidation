<!-- In order for this build file to be referenced by name on import into other build files, 
     it's much nicer to have a short name with no spaces. Please don't change it. -->
<project name="Kettle CE Assembly" basedir="." default="dist" xmlns:ivy="antlib:org.apache.ivy.ant">

  <!-- =================================================================================
       Property Defaults
       Any of these properties can be overridden in either assembly.properties or override.properties
       =================================================================================-->

  <!-- Load the properties files in the proper order -->
  <property file="override.properties"
            description="Properties customized for your development environment belong in this file.  This file will never be checked into the SCM." />
  <property file="build.properties"
            description="Properties customized for your particular project belong in this file." />
  
   <!-- TODO delete when plugins are resolved -->

  <property name="plugin-ids" value="kettle-gpload-plugin,kettle-palo-plugin,kettle-hl7-plugin,kettle-openerp-plugin,kettle-profiling-datacleaner,birt-output,star-modeler,market"/>

  <!-- the impl properties are used to create the manifest file -->
  <property name="impl.title" value="Kettle" />
  <property name="impl.version" value="${project.revision}" />
  <property name="impl.vendor" value="Pentaho Corporation" />

  <import file="build-res/subfloor-pkg.xml" />

  <target name="dist" depends="init,resolve,resolve-swtlibs,package" description="Builds and packages the application"/>
  	
	<target name="package" depends="assemble,unzip-swtlibs,package-zip" description="Creates packaged distributable artifacts" />
	
	<target name="unzip-swtlibs" depends="resolve-swtlibs" description="Unzips the swtlibs bundle">
		<!-- Unzip the libswt package into the libswt folder of the distribution -->
	  <unzip dest="${stage.dir}/${package.root.dir}" overwrite="true">
	    <fileset dir="${swtlib.dir}">
	      <include name="**/*.zip"/>
	    </fileset>
	  </unzip>
  </target>

  <target name="assemble-full" depends="init,resolve,resolve-swtlibs,assemble" description="Builds the application" />

	
  <target name="assemble" depends="subfloor-pkg.assemble" description="copy jar files to distribution directory" >
  	<echo>Construct the distribution package...</echo>
  	    <!-- make JavaApplicationStub executable for OSX -->
  	    <chmod file="${approot.stage.dir}/Data Integration 32-bit.app/Contents/MacOS/JavaApplicationStub" perm="ugo+rx"/>
        <chmod file="${approot.stage.dir}/Data Integration 64-bit.app/Contents/MacOS/JavaApplicationStub" perm="ugo+rx"/>

        <!-- LICENSE.txt -->
  		<copy todir="${approot.stage.dir}/" file="../LICENSE.txt" />

  </target>
	
	<!--=======================================================================
	        resolve-swtlibs
	        
	        Resolved the swtlibs configuration from ivy.xml
	    =====================================================================-->
	  <target name="resolve-swtlibs" depends="install-ivy">
	    <delete dir="${swtlib.dir}" />
	    <ivy:resolve file="${ivyfile}" conf="test" />
	    <ivy:retrieve conf="swtlibs" pattern="${swtlib.dir}/[module]-[revision](-[classifier]).[ext]" symlink="${ivy.use.symlinks.internal}" />
	  </target>
	
	
</project>
