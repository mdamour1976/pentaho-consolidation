<!-- In order for this build file to be referenced by name on import into other build files, 
     it's much nicer to have a short name with no spaces. Please don't change it. -->
<project name="Kettle CE Assembly" basedir="." default="dist" xmlns:ivy="antlib:org.apache.ivy.ant">

  <!-- =================================================================================
       Property Defaults
       Any of these properties can be overridden in either assembly.properties or override.properties
       =================================================================================-->

  <!-- Load the properties files in the proper order -->
  <property file="override.properties"
            description="Properties customized for your development environment belong in this file.  This file will never be checked into the SCM." />
  <property file="build.properties"
            description="Properties customized for your particular project belong in this file." />
  
   <!-- TODO delete when plugins are resolved -->

  <property name="plugin-ids" value="kettle-gpload-plugin,kettle-palo-plugin,kettle-hl7-plugin,kettle-openerp-plugin,kettle-profiling-datacleaner,birt-output,star-modeler,market"/>

  <!-- the impl properties are used to create the manifest file -->
  <property name="impl.title" value="Kettle" />
  <property name="impl.version" value="${project.revision}" />
  <property name="impl.vendor" value="Pentaho Corporation" />

  <import file="build-res/subfloor-pkg.xml" />

  <target name="dist" depends="init,resolve,package" description="Builds and packages the application" />

  <target name="assemble-full" depends="init,resolve,assemble" description="Builds the application" />

	
  <target name="assemble" depends="subfloor-pkg.assemble" description="copy jar files to distribution directory" >
  	<echo>Construct the distribution package...</echo>
  	    
  	    <!-- TODO delete once these jars become available in ivy.xml -->
  		<!-- base lib -->
		<copy todir="${approot.stage.dir}/lib"  file="../lib/kettle-core.jar"/>
	    <copy todir="${approot.stage.dir}/lib"  file="../lib/kettle-db.jar"/>
		<copy todir="${approot.stage.dir}/lib"  file="../lib/kettle-engine.jar"/>
	    <copy todir="${approot.stage.dir}/lib"  file="../lib/kettle-dbdialog.jar"/>
		<copy todir="${approot.stage.dir}/lib"  file="../lib/kettle-ui-swt.jar"/>
  		<copy todir="${approot.stage.dir}/lib"  file="../lib/kettle-test.jar"/>
		<copy todir="${approot.stage.dir}/lib"  file="../lib/kettle-jdbc.jar"/>

  	    <!-- TODO delete once transitives are available in ivy.xml -->
        <!-- external libs (jdbc etc) -->
  		<mkdir dir="${approot.stage.dir}/libext"/>
  		<copy todir="${approot.stage.dir}/libext">
  			<fileset dir="../libext" includes="**/*.jar **/*.zip **/*.properties **/*.xml" excludes="**/.vpn"/>
  			</copy>

  	    <!-- TODO delete when swt assembly is available -->
        <!-- swt libs (jdbc etc) -->
  		<mkdir dir="${approot.stage.dir}/libswt"/>
  		<copy todir="${approot.stage.dir}/libswt">
  			<fileset dir="../libswt" includes="**/*" excludes="**/.vpn **/sapjco*.dll"/>
  			</copy>
  	
  	    <!-- TODO delete when plugins are resolved -->
  		<for list="${plugin-ids}" param="plugin" trim="true">
	  		<sequential>
	  			<copy todir="${approot.stage.dir}/plugins">
	  				<fileset dir="../plugins/@{plugin}/bin/stage" includes="**/*" />
	  			</copy>
  			</sequential>
  		</for>	

  	    <!-- make JavaApplicationStub executable for OSX -->
  	    <chmod file="${approot.stage.dir}/Data Integration 32-bit.app/Contents/MacOS/JavaApplicationStub" perm="ugo+rx"/>
        <chmod file="${approot.stage.dir}/Data Integration 64-bit.app/Contents/MacOS/JavaApplicationStub" perm="ugo+rx"/>

        <!-- LICENSE.txt -->
  		<copy todir="${approot.stage.dir}/" file="../LICENSE.txt" />

  </target>
	
	
	
</project>
